<!DOCTYPE html>
<!--
* NEF Emulator Analytics Dashboard
* For Thesis Demonstration
-->
<html lang="en">

<head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="NEF Emulator Analytics Dashboard">
    <title>Analytics - NEF Emulator</title>
    <link rel='shortcut icon' type='image/x-icon' href='/static/favicon.ico' />

    <!-- Vendors styles-->
    <link rel="stylesheet" href="static/vendors/simplebar/css/simplebar.css">
    <link rel="stylesheet" href="static/css/vendors/simplebar.css">
    <!-- Main styles -->
    <link href="static/css/style.css" rel="stylesheet">
    <!-- Icons -->
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
    <!-- Toastr -->
    <link rel="stylesheet" href="static/toastr@2.1.4/toastr.min.css">

    <script src="static/app/jquery-3.6.0.min.js"></script>
    <script src="static/app/app.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        .chart-card {
            min-height: 300px;
        }

        .stat-big {
            font-size: 3rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>

<body>

    {% include "sidebar.html" ignore missing %}

    <div class="wrapper d-flex flex-column min-vh-100 bg-light">

        {% include "header.html" ignore missing %}

        <div class="body flex-grow-1 px-3">
            <div class="container-lg">

                <!-- Page Header -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h2><i class="icon ion-md-analytics me-2"></i>ðŸ“Š Analytics Dashboard</h2>
                        <p class="text-muted">Compare ML vs A3 handover performance and view test results</p>
                    </div>
                </div>

                <!-- Summary Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="stat-big text-success" id="stat-ml">0</div>
                                <div class="stat-label">ML Decisions</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="stat-big text-warning" id="stat-a3">0</div>
                                <div class="stat-label">A3 Fallbacks</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="stat-big text-info" id="stat-total">0</div>
                                <div class="stat-label">Total Handovers</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="stat-big text-primary" id="stat-ml-pct">0%</div>
                                <div class="stat-label">ML Success Rate</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card chart-card">
                            <div class="card-header">
                                <i class="icon ion-md-stats me-2"></i>Handover Method Comparison
                            </div>
                            <div class="card-body">
                                <canvas id="comparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card chart-card">
                            <div class="card-header">
                                <i class="icon ion-md-pie me-2"></i>Decision Distribution
                            </div>
                            <div class="card-body">
                                <canvas id="distributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Panel -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="icon ion-md-information-circle me-2"></i>How to Use This Dashboard
                            </div>
                            <div class="card-body">
                                <ol class="mb-0">
                                    <li>Go to <a href="/import">Import</a> and load a test scenario</li>
                                    <li>Navigate to <a href="/map">Map</a> and start UE movement</li>
                                    <li>Toggle between ML and A3 modes to compare</li>
                                    <li>Return here to view aggregated results</li>
                                    <li>Export data from the Map page for your thesis</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Refresh Button -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <button class="btn btn-primary" onclick="refreshStats()">
                            <i class="icon ion-md-refresh"></i> Refresh Data
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="resetStats()">
                            <i class="icon ion-md-trash"></i> Reset Stats
                        </button>
                    </div>
                </div>

            </div>
        </div>

        {% include "footer.html" ignore missing %}

    </div>

    <!-- CoreUI and necessary plugins-->
    <script src="static/vendors/@coreui/coreui/js/coreui.bundle.min.js"></script>
    <script src="static/vendors/simplebar/js/simplebar.min.js"></script>
    <script src="static/vendors/@coreui/utils/js/coreui-utils.js"></script>
    <script src="static/toastr@2.1.4/toastr.min.js"></script>

    <script>
        // Analytics data stored in localStorage
        var analyticsData = JSON.parse(localStorage.getItem('nef_analytics') || '{"ml": 0, "a3": 0, "total": 0}');

        var comparisonChart, distributionChart;

        $(document).ready(function () {
            initCharts();
            updateStats();
        });

        function initCharts() {
            // Bar chart for comparison
            var ctx1 = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['ML Predictions', 'A3 Fallbacks'],
                    datasets: [{
                        label: 'Handover Decisions',
                        data: [analyticsData.ml, analyticsData.a3],
                        backgroundColor: ['rgba(40, 167, 69, 0.8)', 'rgba(255, 193, 7, 0.8)'],
                        borderColor: ['rgb(40, 167, 69)', 'rgb(255, 193, 7)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Pie chart for distribution
            var ctx2 = document.getElementById('distributionChart').getContext('2d');
            distributionChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['ML Success', 'A3 Fallback'],
                    datasets: [{
                        data: [analyticsData.ml || 1, analyticsData.a3 || 1],
                        backgroundColor: ['rgba(40, 167, 69, 0.8)', 'rgba(255, 193, 7, 0.8)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateStats() {
            $('#stat-ml').text(analyticsData.ml);
            $('#stat-a3').text(analyticsData.a3);
            $('#stat-total').text(analyticsData.total);
            var pct = analyticsData.total > 0 ? ((analyticsData.ml / analyticsData.total) * 100).toFixed(0) : 0;
            $('#stat-ml-pct').text(pct + '%');

            // Update charts
            if (comparisonChart) {
                comparisonChart.data.datasets[0].data = [analyticsData.ml, analyticsData.a3];
                comparisonChart.update();
            }
            if (distributionChart) {
                distributionChart.data.datasets[0].data = [analyticsData.ml || 1, analyticsData.a3 || 1];
                distributionChart.update();
            }
        }

        function refreshStats() {
            analyticsData = JSON.parse(localStorage.getItem('nef_analytics') || '{"ml": 0, "a3": 0, "total": 0}');
            updateStats();
            toastr.success('Stats refreshed from storage');
        }

        function resetStats() {
            analyticsData = { ml: 0, a3: 0, total: 0 };
            localStorage.setItem('nef_analytics', JSON.stringify(analyticsData));
            updateStats();
            toastr.info('Stats reset to zero');
        }
    </script>

</body>

</html>